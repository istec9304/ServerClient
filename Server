<# ********************************************************************************
* Name     : Server
* Purpose  : ìˆ˜ì§‘ì„œë²„ êµ¬í˜„
* Input    : ì•„ë˜ ì½”ë“œ íŒŒì›Œì‰˜ì—ì„œ ë¶™ì—¬ë„£ê³  ì—”í„°
* Output   : âœ… TCP ì„œë²„ ì‹¤í–‰ë¨. [211.53.249.184:1992] ì—ì„œ ëŒ€ê¸° ì¤‘...
* Period   : ë¹„ì£¼ê¸°
* Limit    :
    - 211.53.249.184:1992 ë°©í™”ë²½ì— ë“±ë¡
    - ì„œê¸°ëŒ€ ì‚¬ë¬´ì‹¤PC ì—ì„œ ì²« ì‹œí—˜ì„±ê³µ
    - í´ë¼ì´ì–¸íŠ¸ëŠ” ì•„ë¬´PC ì—ì„œë‚˜ í…ŒìŠ¤íŠ¸ í•´ë„ ë™ì‘ê°€ëŠ¥
    - ì‹±ê¸€ì“°ë ˆë“œë¡œ ë™ì‘ ( 1:1 ë¡œë§Œë™ì‘ ì„œë²„<->í´ë¼ì´ì–¸íŠ¸)  -> ë©€í‹°ìŠ¤ë ˆë“œë¡œ êµ¬í˜„í•´ì•¼ í•¨!
* Modify   : "2025-04-06"
* Author   : ì„œê¸°ëŒ€
* Memo     : ì²«ë²ˆì§¸ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ëª…ë ¹ì–´ 3ê°œë§Œ ë§Œë“¤ì–´ ë´„
******************************************************************************** #>
# ì„œë²„.ps1
$ip = [System.Net.IPAddress]::Parse("211.53.249.184")
$port = 1992
$listener = [System.Net.Sockets.TcpListener]::new($ip, $port)
$listener.Start()

Write-Host "âœ… TCP ì„œë²„ ì‹¤í–‰ë¨. [$($ip):$port] ì—ì„œ ëŒ€ê¸° ì¤‘..."

while ($true) {
    $client = $listener.AcceptTcpClient()
    $stream = $client.GetStream()
    $buffer = New-Object byte[] 1024

    Write-Host "ğŸ”— í´ë¼ì´ì–¸íŠ¸ ì ‘ì†ë¨."

    while ($client.Connected -and $stream.CanRead) {
        try {
            $bytesRead = $stream.Read($buffer, 0, $buffer.Length)
            if ($bytesRead -le 0) {
                break  # í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²° ì¢…ë£Œí•œ ê²½ìš° ë£¨í”„ íƒˆì¶œ
            }

            $message = [System.Text.Encoding]::UTF8.GetString($buffer, 0, $bytesRead).Trim()
            Write-Host "ğŸ“© í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë°›ì€ ë©”ì‹œì§€: $message"

            # ì‘ë‹µ ë©”ì‹œì§€ ì¤€ë¹„
            $responseText = switch ($message) {
                "AAA" { "ê°€ë‚˜ë‹¤" }
                "BBB" { "ë¼ë§ˆë°”" }
                "CCC" { "ë§ˆì§€ë§‰" }
                "exit" {
                    Write-Host "ğŸ‘‹ í´ë¼ì´ì–¸íŠ¸ ì¢…ë£Œ ìš”ì²­ ê°ì§€ë¨."
                    break
                }
                default { "ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ì…ë‹ˆë‹¤." }
            }

            # íƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨í•œ ì‘ë‹µ ì „ì†¡
            $timestamp = (Get-Date).ToString("yyyy-MM-dd HH:mm:ss")
            $fullResponse = "$timestamp : $responseText"
            $response = [System.Text.Encoding]::UTF8.GetBytes($fullResponse)
            $stream.Write($response, 0, $response.Length)
        }
        catch {
            Write-Host "âš ï¸ ì˜ˆì™¸ ë°œìƒ: $($_.Exception.Message)"
            break
        }
    }

    $stream.Close()
    $client.Close()
    Write-Host "ğŸ” ë‹¤ìŒ í´ë¼ì´ì–¸íŠ¸ ëŒ€ê¸° ì¤‘..."
}

