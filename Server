""" ********************************************************************************
* Name     : Server
* Purpose  : ìˆ˜ì§‘ì„œë²„ êµ¬í˜„
* Input    : ì•„ë˜ ì½”ë“œ íŒŒì›Œì‰˜ì—ì„œ ë¶™ì—¬ë„£ê³  ì—”í„°
* Output   : âœ… TCP ì„œë²„ ì‹¤í–‰ë¨. [211.53.249.184:1992] ì—ì„œ ëŒ€ê¸° ì¤‘...
* Period   : ë¹„ì£¼ê¸°
* Limit    :
    - 211.53.249.184:1992 ë°©í™”ë²½ì— ë“±ë¡
    - ì„œê¸°ëŒ€ ì‚¬ë¬´ì‹¤PC ì—ì„œ ì²« ì‹œí—˜ì„±ê³µ
    - í´ë¼ì´ì–¸íŠ¸ëŠ” ì•„ë¬´PC ì—ì„œë‚˜ í…ŒìŠ¤íŠ¸ í•´ë„ ë™ì‘ê°€ëŠ¥
* Modify   : "2025-04-06"
* Author   : ì„œê¸°ëŒ€
* Memo     : ì²«ë²ˆì§¸ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ëª…ë ¹ì–´ 3ê°œë§Œ ë§Œë“¤ì–´ ë´„
******************************************************************************** """
# ì„œë²„.ps1
$ip = [System.Net.IPAddress]::Parse("211.53.249.184")
$port = 1992
$listener = [System.Net.Sockets.TcpListener]::new($ip, $port)
$listener.Start()

Write-Host "âœ… TCP ì„œë²„ ì‹¤í–‰ë¨. [$($ip):$port] ì—ì„œ ëŒ€ê¸° ì¤‘..."

while ($true) {
    $client = $listener.AcceptTcpClient()
    $stream = $client.GetStream()
    $buffer = New-Object byte[] 1024

    $bytesRead = $stream.Read($buffer, 0, $buffer.Length)
    if ($bytesRead -gt 0) {
        $message = [System.Text.Encoding]::UTF8.GetString($buffer, 0, $bytesRead)
        Write-Host "ğŸ“© í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë°›ì€ ë©”ì‹œì§€: $message"

        # ì‘ë‹µ ë©”ì‹œì§€ ì¤€ë¹„
        $responseText = switch ($message.Trim()) {
            "AAA" { "ê°€ë‚˜ë‹¤" }
            "BBB" { "ë¼ë§ˆë°”" }
            "CCC" { "ë§ˆì§€ë§‰" }
            default { "ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ì…ë‹ˆë‹¤." }
        }

        # íƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨í•œ ì‘ë‹µ ì „ì†¡
        $timestamp = (Get-Date).ToString("yyyy-MM-dd HH:mm:ss")
        $fullResponse = "$timestamp : $responseText"
        $response = [System.Text.Encoding]::UTF8.GetBytes($fullResponse)
        $stream.Write($response, 0, $response.Length)
    }

    $stream.Close()
    $client.Close()
    Write-Host "ğŸ” ë‹¤ìŒ í´ë¼ì´ì–¸íŠ¸ ëŒ€ê¸° ì¤‘..."
}

# listener.Stop() ì€ ë”°ë¡œ ì•ˆ ë„£ì—ˆìŒ â€” ê°•ì œë¡œ ì¢…ë£Œí•˜ë ¤ë©´ Ctrl+C
